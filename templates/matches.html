{% extends "base.html" %}

{% block title %}Tennis Scoreboard | Matches{% endblock %}

{% block content %}
<div class="container">
    <h1>Match History</h1>
    
    <!-- Форма поиска -->
    <div class="search-form">
        <form method="get" action="/matches">
            <input type="hidden" name="page" value="1">
            <label for="filter_by_player_name">Filter by Player:</label>
            <input type="text" id="filter_by_player_name" name="filter_by_player_name" 
                   placeholder="Enter player name"
                   value="{{ player_name_filter }}">
            <button type="submit">Search</button>
            {% if player_name_filter %}
            <a href="/matches?page=1" class="btn-clear">Clear Filter</a>
            {% endif %}
        </form>
    </div>
    
    <!-- Информация о поиске -->
    <div class="search-info">
        {% if player_name_filter %}
            <p>Filtered by player: <strong>{{ player_name_filter }}</strong></p>
        {% endif %}
        <p>Total matches: <strong>{{ total_matches }}</strong></p>
    </div>
    
    <!-- Список матчей -->
    {% if matches %}
    <div class="matches-list">
        <table class="matches-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Player 1</th>
                    <th>Player 2</th>
                    <th>Winner</th>
                    <th>Score</th>
                    <th>Match ID</th>
                </tr>
            </thead>
            <tbody>
                {% for match in matches %}
                <tr>
                    <td>{{ match.date }}</td>
                    <td>{{ match.player1_name }}</td>
                    <td>{{ match.player2_name }}</td>
                    <td class="winner {% if match.winner_name == match.player1_name %}winner-p1{% else %}winner-p2{% endif %}">
                        {{ match.winner_name }}
                    </td>
                    <td class="score">
                        {% for set_name, score in match.score.items() %}
                            {{ score[0] }}-{{ score[1] }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    <td class="match-id">{{ match.uuid[:8] }}...</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Пагинация -->
    {% if total_pages > 1 %}
    <div class="pagination">
        {% if has_previous %}
        <a href="/matches?page={{ previous_page }}{% if player_name_filter %}&filter_by_player_name={{ player_name_filter }}{% endif %}" 
           class="page-link">← Previous</a>
        {% endif %}
        
        {% for p in range(1, total_pages + 1) %}
            {% if p == current_page %}
            <span class="page-current">{{ p }}</span>
            {% else %}
            <a href="/matches?page={{ p }}{% if player_name_filter %}&filter_by_player_name={{ player_name_filter }}{% endif %}" 
               class="page-link">{{ p }}</a>
            {% endif %}
        {% endfor %}
        
        {% if has_next %}
        <a href="/matches?page={{ next_page }}{% if player_name_filter %}&filter_by_player_name={{ player_name_filter }}{% endif %}" 
           class="page-link">Next →</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <div class="no-matches">
        <p>No matches found{% if player_name_filter %} for player "{{ player_name_filter }}"{% endif %}.</p>
    </div>
    {% endif %}
    
    <div class="actions">
        <a href="/" class="btn">Home</a>
        <a href="/new-match" class="btn">New Match</a>
    </div>
</div>
{% endblock %}